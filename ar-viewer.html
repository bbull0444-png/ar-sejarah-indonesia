<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Scanner - Sejarah Indonesia</title>
    
    <!-- A-Frame & AR.js -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #000;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        }

        #loading-screen.hidden {
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Back Button */
        #back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        #back-button:hover {
            transform: translateX(-5px);
            background: white;
        }

        /* Instructions */
        #instructions {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(102, 126, 234, 0.95);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            z-index: 999;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        /* Marker Status */
        #marker-status {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(16, 185, 129, 0.95);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            z-index: 998;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        #marker-status.show {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Info Modal */
        #info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9998;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        #info-modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideUp 0.4s ease;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .modal-title {
            color: #667eea;
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .modal-era {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .modal-body {
            color: #333;
            line-height: 1.8;
            font-size: 15px;
        }

        .modal-body p {
            margin-bottom: 15px;
        }

        .modal-body strong {
            color: #667eea;
        }

        .modal-footer {
            margin-top: 25px;
            text-align: center;
        }

        .btn-close {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }

        .btn-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        /* Virtual Tour Button */
        .tour-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .tour-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.6);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .modal-content {
                padding: 20px;
                max-height: 80vh;
            }

            .modal-title {
                font-size: 20px;
            }

            .modal-body {
                font-size: 14px;
            }

            #instructions {
                font-size: 12px;
                padding: 10px 20px;
            }
        }

        /* Hide A-Frame UI */
        .a-enter-vr-button,
        .a-orientation-modal {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <div class="loading-text">Memuat AR Scanner...</div>
        <div class="loading-subtext">Mohon izinkan akses kamera</div>
    </div>

    <!-- Back Button -->
    <a href="index.html" id="back-button">‚Üê Kembali</a>

    <!-- Instructions -->
    <div id="instructions">
        üì∑ Arahkan kamera ke barcode marker (0-9)
    </div>

    <!-- Marker Status -->
    <div id="marker-status">
        ‚úì Marker Terdeteksi: <span id="marker-name">-</span>
    </div>

    <!-- Info Modal -->
    <div id="info-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Judul Objek</h2>
                <span class="modal-era" id="modal-era">Era</span>
            </div>
            <div class="modal-body" id="modal-body">
                <p>Loading...</p>
            </div>
            <div class="modal-footer">
                <button class="btn-close" onclick="closeModal()">Tutup</button>
                <button class="tour-button" id="tour-button" style="display:none;" onclick="startTour()">
                    üé• Mulai Virtual Tour
                </button>
            </div>
        </div>
    </div>

    <!-- A-Frame AR Scene -->
    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" 
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium;">
        
        <a-entity camera></a-entity>

        <!-- Marker 0: Prasasti Ciaruteun -->
        <a-marker type="barcode" value="0" id="marker-0">
            <a-image 
                src="assets/images/artifacts/ciaruteun.png" 
                width="0.8" 
                height="1.2" 
                position="0 0.6 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat"
                animation="property: rotation; to: -90 360 0; loop: true; dur: 20000; easing: linear">
            </a-image>
        </a-marker>

        <!-- Marker 1: Kapak Genggam -->
        <a-marker type="barcode" value="1" id="marker-1">
            <a-image 
                src="assets/images/artifacts/kapak-genggam.png" 
                width="0.9" 
                height="0.6" 
                position="0 0.4 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat"
                animation="property: position; to: 0 0.5 0; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine">
            </a-image>
        </a-marker>

        <!-- Marker 2: Kapak Lonjong -->
        <a-marker type="barcode" value="2" id="marker-2">
            <a-image 
                src="assets/images/artifacts/kapak-lonjong.png" 
                width="0.9" 
                height="0.6" 
                position="0 0.4 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat"
                animation="property: position; to: 0 0.5 0; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine">
            </a-image>
        </a-marker>

        <!-- Marker 3: Homo Erectus -->
        <a-marker type="barcode" value="3" id="marker-3">
            <a-image 
                src="assets/images/fossils/homo-erectus.png" 
                width="0.6" 
                height="1.2" 
                position="0 0.6 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat">
            </a-image>
        </a-marker>

        <!-- Marker 4: Meganthropus -->
        <a-marker type="barcode" value="4" id="marker-4">
            <a-image 
                src="assets/images/fossils/meganthropus.png" 
                width="0.6" 
                height="1.2" 
                position="0 0.6 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat">
            </a-image>
        </a-marker>

        <!-- Marker 5: Dolmen -->
        <a-marker type="barcode" value="5" id="marker-5">
            <a-image 
                src="assets/images/structures/dolmen.png" 
                width="1.0" 
                height="0.7" 
                position="0 0.5 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat">
            </a-image>
        </a-marker>

        <!-- Marker 6: Kjokkenmoddinger -->
        <a-marker type="barcode" value="6" id="marker-6">
            <a-image 
                src="assets/images/structures/kjokkenmoddinger.png" 
                width="1.0" 
                height="0.8" 
                position="0 0.5 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat">
            </a-image>
        </a-marker>

        <!-- Marker 7: Menhir -->
        <a-marker type="barcode" value="7" id="marker-7">
            <a-image 
                src="assets/images/structures/menhir.png" 
                width="0.5" 
                height="1.5" 
                position="0 0.8 0"
                rotation="-90 0 0"
                transparent="true"
                shader="flat">
            </a-image>
        </a-marker>

        <!-- Marker 8: Candi Borobudur (Virtual Tour) -->
        <a-marker type="barcode" value="8" id="marker-8">
            <a-plane 
                position="0 0 0" 
                rotation="-90 0 0" 
                width="1.5" 
                height="1.5" 
                color="#667eea" 
                opacity="0.8">
            </a-plane>
            <a-text 
                value="CANDI\nBOROBUDUR" 
                align="center" 
                width="2" 
                color="#ffffff"
                position="0 0.01 0"
                rotation="-90 0 0">
            </a-text>
        </a-marker>

        <!-- Marker 9: Candi Prambanan (Virtual Tour) -->
        <a-marker type="barcode" value="9" id="marker-9">
            <a-plane 
                position="0 0 0" 
                rotation="-90 0 0" 
                width="1.5" 
                height="1.5" 
                color="#764ba2" 
                opacity="0.8">
            </a-plane>
            <a-text 
                value="CANDI\nPRAMBANAN" 
                align="center" 
                width="2" 
                color="#ffffff"
                position="0 0.01 0"
                rotation="-90 0 0">
            </a-text>
        </a-marker>

    </a-scene>

    <!-- JavaScript -->
    <script>
        // Marker data - 100% sesuai contents.json
        const markerData = {
            0: {
                name: "Prasasti Ciaruteun",
                type: "artifact",
                era: "Kerajaan Tarumanegara (Abad 5 M)",
                description: "Prasasti Ciaruteun merupakan peninggalan penting Kerajaan Tarumanegara yang ditemukan di Bogor. Prasasti ini terdiri dari dua inskripsi dengan aksara Pallawa berbahasa Sanskerta. Yang paling menarik adalah gambar sepasang telapak kaki yang melambangkan kaki Raja Purnawarman, disamakan dengan Dewa Wisnu sebagai bentuk penghormatan."
            },
            1: {
                name: "Kapak Genggam",
                type: "artifact",
                era: "Zaman Paleolitikum (2 juta - 200 ribu tahun lalu)",
                description: "Kapak genggam adalah alat batu tertua dari masa Paleolitik berbentuk seperti daun dengan kedua sisi diasah tajam. Digunakan untuk memotong daging, menguliti, mengolah kayu, dan menggali umbi. Penemuan terkenal dari Pacitan melahirkan Kebudayaan Pacitan."
            },
            2: {
                name: "Kapak Lonjong",
                type: "artifact",
                era: "Zaman Neolitikum (3000 - 1500 SM)",
                description: "Kapak lonjong menandai revolusi teknologi dari Paleolitikum ke Neolitikum. Dibuat dengan teknik pengasahan hingga permukaannya halus dan licin. Bentuk lonjong memungkinkan penggunaan bertangkai sebagai cangkul atau beliung untuk membuka lahan pertanian."
            },
            3: {
                name: "Homo Erectus",
                type: "fossil",
                era: "Pleistosen Tengah (1,5 juta - 300 ribu tahun lalu)",
                description: "Homo erectus adalah manusia purba penting dalam evolusi manusia, fosil pertamanya ditemukan Eugene Dubois di Trinil tahun 1891. Memiliki tubuh tegap 160-170 cm dengan volume otak 750-1.200 cc. Mampu membuat alat batu, menguasai api untuk memasak dan perlindungan."
            },
            4: {
                name: "Meganthropus Paleojavanicus",
                type: "fossil",
                era: "Pleistosen Awal (1-2 juta tahun lalu)",
                description: "Meganthropus paleojavanicus adalah manusia purba tertua di Indonesia yang fosilnya ditemukan oleh von Koenigswald di Sangiran tahun 1937-1941. Memiliki tubuh tinggi sekitar 2,5 meter, rahang tebal tanpa dagu, gigi geraham besar, dan kapasitas otak 900 cc."
            },
            5: {
                name: "Dolmen",
                type: "structure",
                era: "Zaman Megalitikum (2000 SM - 500 M)",
                description: "Dolmen berasal dari bahasa Breton yang berarti 'meja batu', tersusun dari batu-batu tegak sebagai penyangga dengan satu batu datar besar di atasnya. Berfungsi sebagai tempat sesaji untuk arwah nenek moyang dan penutup kubur batu."
            },
            6: {
                name: "Kjokkenmoddinger",
                type: "structure",
                era: "Zaman Mesolitikum (10.000 - 3000 SM)",
                description: "Kjokkenmoddinger berasal dari bahasa Denmark yang berarti 'sampah dapur', merujuk pada tumpukan kulit kerang dan sisa makanan manusia purba di tepi pantai. Menjadi bukti kehidupan semi-nomaden yang bergantung pada hasil laut."
            },
            7: {
                name: "Menhir",
                type: "structure",
                era: "Zaman Megalitikum (2000 SM - 500 M)",
                description: "Menhir adalah batu tegak vertikal berukuran besar dari batu alam yang bersifat sakral. Memiliki fungsi sebagai sarana pemujaan, tempat peringatan, simbol kekuatan dan identitas, serta tempat menampung roh leluhur."
            },
            8: {
                name: "Candi Borobudur",
                type: "virtual-tour",
                era: "Dinasti Syailendra (780-830 M)",
                location: "Magelang, Jawa Tengah",
                description: "Candi Buddha terbesar di dunia yang dibangun pada abad ke-8. Memiliki struktur punden berundak dengan relief yang menggambarkan ajaran Buddha Mahayana.",
                tourUrl: "virtual-tour.html?temple=borobudur"
            },
            9: {
                name: "Candi Prambanan",
                type: "virtual-tour",
                era: "Kerajaan Mataram Kuno (856 M)",
                location: "Sleman, Yogyakarta",
                description: "Kompleks candi Hindu terbesar di Indonesia yang dibangun pada abad ke-9. Terdiri dari 240 struktur candi dengan Candi Siwa sebagai candi utama setinggi 47 meter.",
                tourUrl: "virtual-tour.html?temple=prambanan"
            }
        };

        let currentMarkerId = null;
        let currentTourUrl = null;

        // Hide loading screen
        function hideLoading() {
            console.log('Hiding loading screen');
            const loading = document.getElementById('loading-screen');
            if (loading) {
                loading.classList.add('hidden');
            }
        }

        // Show marker status
        function showMarkerStatus(markerName) {
            const status = document.getElementById('marker-status');
            const nameSpan = document.getElementById('marker-name');
            if (status && nameSpan) {
                nameSpan.textContent = markerName;
                status.classList.add('show');
            }
        }

        // Hide marker status
        function hideMarkerStatus() {
            const status = document.getElementById('marker-status');
            if (status) {
                status.classList.remove('show');
            }
        }

        // Show info modal
        function showInfo(markerId) {
            const data = markerData[markerId];
            if (!data) return;

            document.getElementById('modal-title').textContent = data.name;
            document.getElementById('modal-era').textContent = data.era;
            document.getElementById('modal-body').innerHTML = `<p>${data.description}</p>`;

            const tourButton = document.getElementById('tour-button');
            if (data.type === 'virtual-tour') {
                tourButton.style.display = 'block';
                currentTourUrl = data.tourUrl;
            } else {
                tourButton.style.display = 'none';
                currentTourUrl = null;
            }

            document.getElementById('info-modal').classList.add('show');
        }

        // Close modal
        function closeModal() {
            document.getElementById('info-modal').classList.remove('show');
        }

        // Start virtual tour
        function startTour() {
            if (currentTourUrl) {
                window.location.href = currentTourUrl;
            }
        }

        // Initialize AR
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');

            const scene = document.querySelector('a-scene');
            
            if (scene) {
                // Hide loading when scene is loaded
                scene.addEventListener('loaded', function() {
                    console.log('A-Frame scene loaded');
                    setTimeout(hideLoading, 500);
                });

                // Alternative: Hide when rendering starts
                scene.addEventListener('renderstart', function() {
                    console.log('A-Frame render started');
                    hideLoading();
                });

                // Setup marker event listeners
                for (let i = 0; i <= 9; i++) {
                    const marker = document.querySelector(`#marker-${i}`);
                    if (marker) {
                        marker.addEventListener('markerFound', function() {
                            console.log(`Marker ${i} found`);
                            currentMarkerId = i;
                            const data = markerData[i];
                            if (data) {
                                showMarkerStatus(data.name);
                                // Auto show modal after 1 second
                                setTimeout(() => showInfo(i), 1000);
                            }
                        });

                        marker.addEventListener('markerLost', function() {
                            console.log(`Marker ${i} lost`);
                            hideMarkerStatus();
                            currentMarkerId = null;
                        });
                    }
                }
            }

            // Emergency fallback: Hide loading after 5 seconds
            setTimeout(function() {
                console.log('Emergency: Force hiding loading screen');
                hideLoading();
            }, 5000);
        });

        // Hide loading on window load (backup)
        window.addEventListener('load', function() {
            console.log('Window loaded');
            setTimeout(hideLoading, 2000);
        });
    </script>
</body>
</html>
